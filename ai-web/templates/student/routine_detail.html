{% extends 'base/student_base.html' %}

{% block title %}{{ routine.routine_name }}{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/student.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid py-2">
    <!-- Page Header -->
    <div class="page-header-modern mb-3">
        <div class="page-header-content">
            <div class="page-header-text">
                <h1 class="page-header-title">{{ routine.routine_name }}</h1>
                <div class="d-flex flex-wrap gap-2 align-items-center mt-2">
                    <span class="badge bg-secondary">{{ routine.routine_code }}</span>
                    <span class="student-level-badge 
                        {% if routine.level == 'beginner' %}student-level-beginner
                        {% elif routine.level == 'intermediate' %}student-level-intermediate
                        {% elif routine.level == 'advanced' %}student-level-advanced
                        {% endif %}">
                        {% if routine.level == 'beginner' %}Sơ cấp
                        {% elif routine.level == 'intermediate' %}Trung cấp
                        {% elif routine.level == 'advanced' %}Nâng cao
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
        <div class="page-header-actions">
            <a href="{{ url_for('student.routines') }}" class="btn btn-light btn-sm">
                Quay lại
            </a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="row g-2">
        <!-- Left Column: Description & Info -->
        <div class="col-lg-8">
            {% if routine.description %}
            <div class="card border-0 shadow-sm mb-2">
                <div class="card-header bg-white border-0 py-2">
                    <h5 class="mb-0">Mô Tả</h5>
                </div>
                <div class="card-body p-3">
                    <p class="mb-0" style="line-height: 1.8; white-space: pre-wrap;">{{ routine.description }}</p>
                </div>
            </div>
            {% endif %}
            
            <!-- Key Information Grid -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Thông Tin Bài Võ</h5>
                        <span class="badge bg-success">Đã xuất bản</span>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="student-info-grid">
                        <div class="student-info-item">
                            <div>
                                <small class="text-muted d-block">Thời lượng</small>
                                <strong>{{ (routine.duration_seconds / 60)|round(1) }} phút</strong>
                            </div>
                        </div>
                        <div class="student-info-item">
                            <div>
                                <small class="text-muted d-block">Số động tác</small>
                                <strong>{{ routine.total_moves }} động tác</strong>
                            </div>
                        </div>
                        <div class="student-info-item">
                            <div>
                                <small class="text-muted d-block">Độ khó</small>
                                <strong>{{ "%.1f"|format(routine.difficulty_score|float) }}/10</strong>
                            </div>
                        </div>
                        <div class="student-info-item">
                            <div>
                                <small class="text-muted d-block">Ngưỡng đạt</small>
                                <strong>{{ "%.0f"|format(routine.pass_threshold|float) }}%</strong>
                            </div>
                        </div>
                        <div class="student-info-item">
                            <div>
                                <small class="text-muted d-block">Giảng viên</small>
                                <strong>{{ routine.creator.full_name if routine.creator else 'N/A' }}</strong>
                            </div>
                        </div>
                        <div class="student-info-item">
                            <div>
                                <small class="text-muted d-block">Ngày tạo</small>
                                <strong>{{ routine.created_at.strftime('%d/%m/%Y') }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Column: Video & Actions -->
        <div class="col-lg-4">
            <!-- Video Section -->
            {% if routine.reference_video_url %}
            <div class="card border-0 shadow-sm mb-2">
                <div class="card-header bg-white border-0 py-2">
                    <h5 class="mb-0">Video Hướng Dẫn</h5>
                </div>
                <div class="card-body p-0">
                    <div class="ratio ratio-16x9">
                        <video controls playsinline preload="metadata" class="w-100 h-100" style="object-fit: contain;">
                            <source src="{{ get_video_url(routine.reference_video_url) }}" type="video/mp4">
                            Trình duyệt không hỗ trợ video.
                        </video>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Actions -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-2">
                    <h5 class="mb-0">Hành Động</h5>
                </div>
                <div class="card-body p-3">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('student.my_assignments') }}" class="btn btn-primary btn-sm">
                            Xem bài tập liên quan
                        </a>
                        <a href="{{ url_for('student.my_exams') }}" class="btn btn-outline-primary btn-sm">
                            Xem kiểm tra liên quan
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/student.js') }}"></script>
{% endblock %}
