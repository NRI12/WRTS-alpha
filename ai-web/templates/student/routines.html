{% extends 'base/student_base.html' %}

{% block title %}Danh Sách Bài Võ{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/student.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-2">
    <!-- Modern Header -->
    <div class="page-header-modern mb-3">
        <div class="page-header-content">
            <div class="page-header-text">
                <h1 class="page-header-title">Danh Sách Bài Võ</h1>
                <p class="page-header-subtitle">Khám phá và học tập các bài võ</p>
            </div>
        </div>
        <div class="page-header-actions">
            <a href="{{ url_for('student.dashboard') }}" class="btn btn-light btn-sm">
                Quay lại
            </a>
        </div>
    </div>
    
    <!-- Filter Bar -->
    <div class="student-filter-bar mb-2">
        <form method="GET" class="row g-2 align-items-end">
            <div class="col-md-5">
                <label class="student-filter-label">
                    Cấp độ
                </label>
                <select name="level" class="form-select student-routine-filter-select">
                    <option value="">Tất cả cấp độ</option>
                    <option value="beginner" {{ 'selected' if request.args.get('level') == 'beginner' }}>Sơ cấp</option>
                    <option value="intermediate" {{ 'selected' if request.args.get('level') == 'intermediate' }}>Trung cấp</option>
                    <option value="advanced" {{ 'selected' if request.args.get('level') == 'advanced' }}>Nâng cao</option>
                </select>
            </div>
            
            <div class="col-md-5">
                <label class="student-filter-label">
                    Binh khí
                </label>
                <select name="weapon_id" class="form-select student-routine-filter-select">
                    <option value="" {{ 'selected' if not request.args.get('weapon_id') }}>Tất cả binh khí</option>
                    {% for weapon in weapons %}
                    <option value="{{ weapon.weapon_id }}" {{ 'selected' if (request.args.get('weapon_id')|int) == weapon.weapon_id }}>
                        {{ weapon.weapon_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    Lọc
                </button>
            </div>
        </form>
    </div>
    
    <!-- Routines List -->
    {% if routines %}
        <div class="row">
            <div class="col-12">
                <p class="text-muted mb-2">
                    Tìm thấy <strong>{{ routines|length }}</strong> bài võ
                </p>
            </div>
        </div>
        
        {% for routine in routines %}
        <div class="student-routine-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <h5 class="mb-2">{{ routine.routine_name }}</h5>
                    <span class="badge bg-secondary me-2">{{ routine.routine_code }}</span>
                    <span class="student-level-badge 
                        {% if routine.level == 'beginner' %}student-level-beginner
                        {% elif routine.level == 'intermediate' %}student-level-intermediate
                        {% elif routine.level == 'advanced' %}student-level-advanced
                        {% endif %}">
                        {% if routine.level == 'beginner' %}Sơ cấp
                        {% elif routine.level == 'intermediate' %}Trung cấp
                        {% elif routine.level == 'advanced' %}Nâng cao
                        {% endif %}
                    </span>
                </div>
                {% if routine.weapon %}
                <span class="student-weapon-badge">
                    {{ routine.weapon.weapon_name }}
                </span>
                {% endif %}
            </div>
            
            {% if routine.description %}
            <p class="text-muted mb-2">{{ routine.description }}</p>
            {% endif %}
            
            <div class="student-info-grid mb-2">
                <div class="student-info-item">
                    <span><strong>Thời lượng:</strong> {{ (routine.duration_seconds / 60)|round(1) }} phút</span>
                </div>
                <div class="student-info-item">
                    <span><strong>Giảng dạy:</strong> {{ routine.creator.full_name if routine.creator else 'N/A' }}</span>
                </div>
                <div class="student-info-item">
                    <span><strong>Tạo lúc:</strong> {{ routine.created_at.strftime('%d/%m/%Y') }}</span>
                </div>
            </div>
            
            <a href="{{ url_for('student.routine_detail', routine_id=routine.routine_id) }}" 
               class="btn btn-primary btn-sm">
                Xem chi tiết
            </a>
        </div>
        {% endfor %}
    {% else %}
        <div class="student-empty-state">
            <h4 class="student-empty-state-title">Không tìm thấy bài võ nào</h4>
            <p class="student-empty-state-text">
                Thử thay đổi bộ lọc để xem thêm bài võ khác
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/student.js') }}"></script>
{% endblock %}